<!-- nutritional -->
<section class="nutritional">
  <div class="calories">
    <div class="calories__consumed">
      <p class="calories__value">{{ caloriesConsumed }}</p>
      <p class="calories__label">&nbsp;потребление</p>
    </div>
    <tui-ring-chart [value]="[caloriesConsumed, caloriesLeft]">
      <div class="calories__left">
        {{ caloriesLeft }} из {{ caloriesMax() }} ккал осталось
      </div>
    </tui-ring-chart>

    <div class="calories__spent">
      <p class="calories__value">0</p>
      <p class="calories__label">&nbsp;расход</p>
    </div>
  </div>

  <div class="macronutrients">
    <div class="macronutrient">
      <span class="macronutrient__item">Белки</span>
      <progress
        tuiProgressBar
        new
        size="s"
        [value]="proteinCurrent"
        [max]="proteinMax()"
      ></progress>
      <span class="macronutrient__value"
        >{{ proteinCurrent | number : "1.0-0" }} из {{ proteinMax() }}г</span
      >
    </div>

    <div class="macronutrient">
      <span class="macronutrient__item">Жиры</span>
      <progress
        tuiProgressBar
        new
        size="s"
        [value]="fatCurrent"
        [max]="fatMax()"
      ></progress>
      <span class="macronutrient__value"
        >{{ fatCurrent | number : "1.0-0" }} из {{ fatMax() }}г</span
      >
    </div>

    <div class="macronutrient">
      <span class="macronutrient__item">Углеводы</span>
      <progress
        tuiProgressBar
        new
        size="s"
        [value]="carbsCurrent"
        [max]="carbsMax()"
      ></progress>
      <span class="macronutrient__value"
        >{{ carbsCurrent | number : "1.0-0" }} из {{ carbsMax() }}г</span
      >
    </div>
  </div>
</section>

<!-- calendar -->
<section class="calendar">
  <tui-input-date
    [formControl]="dateControl"
    [tuiTextfieldCleaner]="true"
    [tuiTextfieldSize]="'m'"
    >Выберите дату</tui-input-date
  >
</section>

<!-- meals -->

<section class="meals-accordion">
  @for (meal of meals; track $index) {
    <div class="meal-panel">
      <div
        class="meal-panel__header"
        (click)="meal.isExpanded = !meal.isExpanded"
      >
        <h3>{{ meal.type }}</h3>
        <span>{{ meal.totalCalories | number : "1.0-0" }} ккал</span>
        <button tuiIconButton icon="tuiIconPlus" appearance="secondary"></button>
      </div>

      <!-- аккордеон -->
      <tui-expand [expanded]="meal.isExpanded">
        <!-- Поиск еды -->
        <div class="meal-search">
          <tui-input
            [formControl]="meal.searchControl"
            [tuiTextfieldCleaner]="true"
            tuiTextfieldSize="m"
            class="meal-search__input"
          >
            Введите штрихкод...
          </tui-input>
        </div>

        <!-- Результаты поиска -->
        <div *ngIf="meal.searchResults.length > 0" class="search-results">
          <div *ngFor="let result of meal.searchResults" class="search-result">
            <span>{{ result.label }}</span>
            <button
              tuiButton
              size="xs"
              appearance="outline"
              (click)="onAddFoodToMeal(meal, result)"
            >
              Добавить
            </button>
          </div>
        </div>

        <!-- Список добавленных продуктов -->
        <div class="meal-items">
          <div *ngFor="let item of meal.items; let i = index" class="meal-item">
            <span>{{ item.label }}</span>
            <span>{{ item.quantity }} г</span>
            <span>{{ item.calories | number : "1.0-0" }} ккал</span>
            <button
              tuiIconButton
              icon="tuiIconClose"
              appearance="error"
              (click)="removeFoodFromMeal(meal, i)"
            ></button>
          </div>
        </div>
      </tui-expand>
    </div>

  }
</section>

<!-- water-tracker -->
<app-water-tracker
  [waterGlasses]="waterGlasses"
  [totalWater]="totalWater"
  (waterChange)="onWaterChange($event)"
></app-water-tracker>
